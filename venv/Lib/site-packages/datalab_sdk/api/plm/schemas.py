from marshmallow import fields
from datetime import datetime
from datalab_sdk.api.common.schema import UpperCaseSchema

# Schema customised for PLM
class PlmSchema(UpperCaseSchema):
    #todo: find a way to convert to/from date fields (these seem to be ignored)
    #key_date = fields.Method("dump_date", deserialize="load_date")
    #valid_from = fields.Method("dump_date", deserialize="load_date")
    #valid_to = fields.Method("dump_date", deserialize="load_date")

    def on_bind_field(self, field_name, field_obj):
        super().on_bind_field( field_name, field_obj)

        if field_obj.data_key == "SPECIFICATIONALTVERSION":
            field_obj.data_key = "SPECIFICATION_ALT_VERSION"
            
        if field_obj.data_key == "QUANTITYPERPO":
            field_obj.data_key = "QUANTITYPERPO%"

    def dump_date(self, value):
        return value.strftime('%Y%m%d')

    def load_date(self, value):
        return datetime.strptime(value, '%Y%m%d')
